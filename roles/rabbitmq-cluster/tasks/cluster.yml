---
- name: stopping rabbitmq app
  command: rabbitmqctl stop_app
  become: true

- name: resetting rabbitmq app
  command: rabbitmqctl reset
  become: true
  
- name: stopping rabbitmq service
  systemd: state=stopped name=rabbitmq-server
  
- name : cookie
  shell: echo "skander" >/var/lib/rabbitmq/.erlang.cookie

- name : config
  shell: echo "[{rabbit,[{cluster_nodes,{[ 'rabbit@rabbitmq-0','rabbit@rabbitmq-1','rabbit@rabbitmq-2'],disc}}]}].">/etc/rabbitmq/rabbitmq.config
  
- name: force handler s execution , not waiting for normal sync points
  meta: flush_handlers

- name: Make sure a rabbitmq-server service is running
  systemd: state=started name=rabbitmq-server
  
- name: starting rabbitmq app
  command: rabbitmqctl start_app
  become: true
